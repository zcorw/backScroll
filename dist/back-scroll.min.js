/*!back-scroll - 滚动加载 | zcorw*/
!function(a,b){"function"==typeof define&&define.amd?define(["jquery","wechatBack"],b):"object"==typeof exports?module.exports=b(require("jquery")):b(a.jQuery)}(this,function(a){function b(b,c){this.frame=b,this.target=a(window),this.opts=c,this.page=1,this.isScroll=!1,this.isLoad=!1,this.isOver=!1,this.init()}var c={container:"ul",type:"post",action:null,data:{},pageKey:"page",contentLoad:null,beforeLoad:function(){},afterLoad:function(a){},overLoad:function(a){return!1},heightOffset:10};b.prototype.init=function(){var b=this,c=this.target;this.frame;b.isScroll=!0,a(c).scroll(function(d){if(b.isScroll===!0&&b.isOver!==!0){if(b.isLoad!==!0){var e=a(c).scrollTop()+b.opts.heightOffset>=a(document).height()-a(c).height();e&&b.loadContent()}}else d.stopPropagation()})},b.prototype.loadContent=function(){var b=this,c=(this.target,this.opts),d=this.frame;c.beforeLoad(),a(d).children().attr("rel","loaded"),this.isLoad=!0;var e=c.data;if(e[c.pageKey]=this.page,null===c.contentLoad)var f="html";else var f="json";a.ajax({type:c.type,url:c.action,data:e,success:function(e){null===c.contentLoad?a(d).append(e):a(d).append(c.contentLoad(e));var f=a(d).children("[rel!=loaded]");c.afterLoad(f),b.page++,c.overLoad(e)?b.isOver=!0:b.isLoad=!1},dataType:f})},b.prototype.stopScroll=function(){this.isScroll=!1},b.prototype.firstLoad=function(){this.isOver!==!0&&this.isLoad!==!0&&1==this.page&&this.loadContent()},b.prototype.changeOpts=function(b){this.opts=a.extend({},this.opts,b)},b.prototype.getStatus=function(){var a={data:JSON.stringify(this.opts.data),page:this.page,isScroll:this.isScroll,isLoad:this.isLoad,isOver:this.isOver};return JSON.stringify(a)},b.prototype.setStatus=function(a){JSON.parse(a);this.changeData},a.fn.backScroll=function(d){return this.each(function(){var e=a(this).data("scroll");if(e)switch(d){case"stop":e.stopScroll();break;case"firstload":e.firstLoad();break;case"option":e.changeOpts(arguments[1]);break;default:e.init()}else{var f=a.extend({},c,d);e=new b(a(this).find(f.container),f),a(this).data("scroll",e)}})}});
